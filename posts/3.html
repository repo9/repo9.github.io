<html>
<head>

<h2>클라이언트-인증자 프로토콜(CTAP)</h2>

</head>
<body>
<h4>5.1. 인증자MakeCredential(0x01)</h4>

이 메서드는 인증자에서 새 자격 증명 생성을 요청하기 위해 호스트에 의해 호출됩니다. 웹 인증 사양 의 인증자MakeCredential 작업 섹션에 정의된 것과 명시적으로 일치하는 다음 입력 매개변수를 사용 합니다.

매개변수 이름	데이터 형식	필수의?	정의
클라이언트 데이터 해시(0x01)	바이트 배열	필수의	호스트에서 지정한 ClientData 컨텍스트 바인딩의 해시입니다. [WebAuthn] 을 참조하십시오 .
rp(0x02)	PublicKeyCredentialRpEntity	필수의	이 PublicKeyCredentialRpEntity 데이터 구조는 새 공개 키 자격 증명 이 연결될 신뢰 당사자를 설명합니다. 여기에는 텍스트 문자열 유형의 신뢰 당사자 식별자 , 텍스트 문자열 유형의 사람에게 친숙한 RP 이름(선택 사항) 및 RP 아이콘 이미지를 참조하는 텍스트 문자열 유형의 URL(선택 사항)이 포함됩니다. RP 이름은 선택 및 사용 권한 부여를 위해 사용자에게 자격 증명을 표시할 때 인증자가 사용합니다. RP 이름과 URL은 선택 사항이므로 원하는 경우 RP가 보다 개인 정보를 보호할 수 있습니다. 예를 들어, 디스플레이가 있는 인증자의 경우 RP는 단일 요소 시나리오에 대해 이름/아이콘을 표시하지 않을 수 있습니다.
사용자(0x03)	PublicKeyCredentialUserEntity	필수의	이 PublicKeyCredentialUserEntity 데이터 구조는 새 공개 키 자격 증명 이 있는 사용자 계정을 설명합니다.RP에 연결됩니다. 여기에는 바이트 배열 유형의 RP 고유 사용자 계정 식별자, (선택 사항) 텍스트 문자열 유형의 사용자 이름, (선택 사항) 텍스트 문자열 유형의 사용자 표시 이름 및 (선택 사항) 텍스트 문자열 유형의 URL이 포함됩니다. 사용자 아이콘 이미지(예: 사용자 아바타). 인증자는 생성된 공개 키 자격 증명을 계정 식별자와 연결하고 사용자 이름, 사용자 표시 이름 및 이미지 데이터(있는 경우 URL이 가리키는) 중 일부 또는 전체를 연결할 수도 있습니다(MAY). 사용자 이름, 표시 이름 및 URL은 사용자 존재만 필요한 단일 요소 시나리오의 개인 정보 보호를 위해 선택 사항입니다. 예를 들어, 공장 작업장과 같은 특정 폐쇄된 물리적 환경에서 사용자 존재 인증자는 RP의 생산성 및 보안 요구 사항을 충족할 수 있습니다. 이러한 환경에서 사용자 이름, 표시 이름 및 URL을 생략하면 자격 증명이 보다 개인 정보를 보호할 수 있습니다. 이 정보는 사용자 확인 없이는 사용할 수 없지만 사용자 확인을 지원하지만 구성되지 않은 장치는 사용자 확인을 구성하여 이 정보를 공개하도록 속일 수 있습니다.
pubKeyCredParams(0x04)	CBOR 어레이	필수의	PublicKeyCredentialType(문자열) 및 암호화 알고리즘(양수 또는 음수 정수)의 쌍으로 구성된 CBOR 맵의 시퀀스입니다. 여기서 알고리즘 식별자는 IANA COSE 알고리즘 레지스트리 [IANA-COSE-ALGS-REG] 에 등록되어야 하는 값입니다 . 이 순서는 가장 선호되는 것(RP에 의해)에서 가장 덜 선호되는 것 순으로 정렬됩니다.
제외 목록(0x05)	PublicKeyCredentialDescriptors 시퀀스	선택 과목	[WebAuthn] 에 지정된 대로 PublicKeyCredentialDescriptor 구조의 시퀀스입니다 . 인증자가 이 시퀀스에 열거된 자격 증명 중 하나를 이미 포함하는 경우 인증자는 오류를 반환합니다. 이를 통해 RP는 단일 인증자의 동일한 계정에 대한 여러 자격 증명 생성을 제한할 수 있습니다.
확장자(0x06)	확장 식별자 의 CBOR 맵 → 인증자 확장 입력 값	선택 과목	[WebAuthn] 에 지정된 인증자 작업에 영향을 주는 매개변수 입니다. 이러한 매개변수는 인증자에 따라 다를 수 있습니다.
옵션(0x07)	인증자 옵션 맵	선택 과목	아래 표에 지정된 대로 인증자 작업에 영향을 주는 매개변수입니다.
핀인증
(0x08)	바이트 배열	선택 과목	플랫폼이 인증자로부터 얻은 pinToken 을 사용하는 clientDataHash의 HMAC-SHA-256의 처음 16바이트 : . HMAC-SHA-256(pinToken, clientDataHash)
핀프로토콜(0x09)	부호 없는 정수	선택 과목	클라이언트가 선택한 PIN 프로토콜 버전

options 매개변수에 사용하기 위해 다음 값이 정의됩니다. 모든 옵션은 부울입니다.

열쇠	기본값	정의
크크	거짓	상주 키: 인증자가 장치에 키 자료를 저장하도록 지시합니다.
자외선	거짓	사용자 확인: 인증자가 요청을 완료하기 위해 사용자를 확인하는 제스처를 요구하도록 지시합니다. 이러한 제스처의 예로는 지문 스캔 또는 PIN이 있습니다.
[ WebAuthn ]authenticatorMakeCredential 사양은 이 섹션에서 설명하는 작업에 해당 하는 추상 작업을 정의합니다 . 추상 [WebAuthn] authenticatorMakeCredential 작업의 매개변수는 다음과 같이 위의 매개변수에 매핑됩니다.

[WebAuthn] authenticatorMakeCredential 작업	CTAP authenticatorMakeCredential작업
해시시	클라이언트 데이터 해시
rpEntity	rp
userEntity	사용자
요구하다ResidentKey	옵션.rk
사용자 존재 필요	현재 버전의 CTAP에는 없습니다. 인증자는 항상 사용자 존재를 확인하는 것으로 가정합니다.
사용자 확인 필요	options.uv 또는 pinAuth/pinProtocol
credTypesAndPubKeyAlgs	pubKeyCredParams
제외 자격 증명 설명자 목록	제외 목록
확장	확장
인증자와 함께 사용되는 아이콘 값 은 이미지 데이터가 참조가 아닌 값으로 전달되도록 [RFC2397] "데이터" URL을 사용할 수 있습니다. 이렇게 하면 디스플레이는 있지만 인터넷에 연결되어 있지 않은 인증자가 아이콘을 표시할 수 있습니다.

텍스트 문자열은 UTF-8로 인코딩된 문자열(CBOR 주요 유형 3)입니다.

요청이 수신 되면 authenticatorMakeCredential인증자는 다음 절차를 수행합니다.

excludeList 매개변수가 있고 이 인증자에 있고 지정된 rpId에 바인딩된 자격 증명 ID를 포함하는 경우 사용자가 있을 때까지 기다린 다음 이 절차를 종료하고 오류 코드 CTAP2_ERR_CREDENTIAL_EXCLUDED를 반환합니다. CTAP1/U2F 인증자와 유사하게 동작하도록 토큰이 이미 등록되어 있다고 RP에 알리기 전에 CTAP2 인증자에 대한 사용자 존재 확인이 필요합니다.

pubKeyCredParams 매개변수에 인증자가 지원하는 유효한 COSEAlgorithmIdentifier 값이 포함되어 있지 않으면 이 절차를 종료하고 오류 코드 CTAP2_ERR_UNSUPPORTED_ALGORITHM을 반환합니다.

options 매개변수가 있는 경우 모든 옵션을 처리합니다. 옵션이 알려져 있지만 지원되지 않는 경우 이 절차를 종료하고 CTAP2_ERR_UNSUPPORTED_OPTION을 반환합니다. 옵션이 알려져 있지만 이 명령에 유효하지 않은 경우 이 절차를 종료하고 CTAP2_ERR_INVALID_OPTION을 반환합니다. 이해되지 않는 옵션은 무시하십시오. 이 사양은 표준 동작을 정의하기 때문에 모든 인증자는 "rk", "up" 및 "uv" 옵션을 이해해야 합니다.

선택적으로 확장 매개변수가 있는 경우 이 인증자가 지원하는 확장을 처리합니다. 인증자 확장 처리에 의해 생성된 인증자 확장 출력 은 인증자 데이터 에 반환됩니다 .

pinAuth 매개변수가 있고 pinProtocol이 1 이면 pinToken : 을 사용하여 clientDataHash 매개변수의 HMAC-SHA-256의 처음 16바이트와 일치시켜 확인합니다 HMAC- SHA-256(pinToken, clientDataHash).

확인이 성공하면 응답에서 "uv" 비트를 1로 설정합니다.

확인에 실패하면 CTAP2_ERR_PIN_AUTH_INVALID 오류를 반환합니다.

pinAuth 매개변수가 없고 clientPin 이 인증자에 설정되어 있으면 CTAP2_ERR_PIN_REQUIRED 오류를 반환합니다.

pinAuth 매개변수가 있고 pinProtocol이 지원되지 않는 경우 CTAP2_ERR_PIN_AUTH_INVALID를 반환합니다.

인증자에 디스플레이가 있는 경우 사용자 및 rp 매개변수 구조에 포함된 항목을 사용자에게 표시합니다. 또는 인증자별 방식으로 사용자 상호 작용을 요청합니다(예: LED 표시등 깜박임). 자격 증명을 만들 수 있는 권한을 요청합니다. 사용자가 권한을 거부하면 CTAP2_ERR_OPERATION_DENIED 오류를 반환합니다.

지정된 알고리즘에 대한 새 자격 증명 키 쌍 을 생성합니다.

옵션 매개변수의 "rk"가 true로 설정된 경우:

인증자에 동일한 RP ID 및 계정 ID에 대한 자격 증명이 이미 있는 경우 해당 자격 증명을 덮어씁니다.

새로 생성된 키 쌍을 따라 사용자 매개변수를 저장합니다.

인증자가 새 자격 증명을 유지하기에 충분한 내부 저장소가 없는 경우 CTAP2_ERR_KEY_STORE_FULL을 반환합니다.

clientDataHash를 사용하여 새로 생성된 키에 대한 증명 문을 생성합니다.

성공하면 인증 자는 [WebAuthn] 에 정의된 대로 응답에 증명 개체 를 반환합니다 .

회원 이름	데이터 형식	필수의?	정의
인증 데이터(0x01)	바이트 배열	필수의	인증자 데이터 개체 입니다.
fmt(0x02)	끈	필수의	증명 문 형식 식별자 입니다 .
attStmt(0x03)	증명 문 형식 식별자에 따라 구조가 달라지는 바이트 배열	필수의	형식이 "fmt" 개체 구성원으로 식별되는 증명 문입니다. 클라이언트는 그것을 불투명한 객체로 취급합니다.


</body>
</html>